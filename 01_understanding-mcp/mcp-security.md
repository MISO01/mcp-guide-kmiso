# MCP 보안 고려사항 (Security Considerations for MCP)

MCP는 AI 모델이 외부 시스템과 안전하게 상호작용할 수 있도록 설계된 구조지만,  
그만큼 MCP 서버 개발자와 클라이언트 구현자 모두가 **철저한 보안 설계**를 해야 합니다.

이 문서는 MCP와 관련된 기술 보안 구조 중심으로 주요 리스크와 방어 전략을 설명합니다.

---

## 1. OAuth 기반 인증 구조와 리스크

MCP는 OAuth 2.0/2.1 기반의 인증 체계를 사용할 수 있으며,  
이 구조는 강력하지만 **구현 실수 시 치명적인 취약점**을 초래할 수 있습니다.

### 주요 리스크

- **Open Redirect**: 승인 후 리디렉션 URL 검증이 없으면 악성 사이트로 연결 가능
- **PKCE 미적용**: 중간자 공격에 취약
- **토큰 탈취**: Access Token 저장 위치 또는 전송 경로가 안전하지 않을 경우
- **권한 과잉 부여**: scope 설정이 광범위할 경우 불필요한 자원 접근 발생

### 보안 권장 사항

- OAuth 2.1 또는 OpenID Connect 준수
- **PKCE 적용 필수** (특히 모바일/브라우저 환경)
- 토큰은 `HttpOnly + Secure` 쿠키 또는 안전한 클라이언트 저장소 사용
- JWT 사용 시 만료 시간 설정 + 자동 갱신 + 폐기 처리
- 범위(scope)는 기능 단위로 세분화

---

## 2. Human-in-the-loop: 사용자 동의 기반 설계

MCP는 외부 도구 호출 전 **사용자에게 명시적으로 권한을 요청**해야 합니다.  
이 구조는 **자동화된 악성 도구 실행을 막는 중요한 장치**입니다.

### 보안 설계 포인트

- 명확한 요청 문구로 “어떤 도구가 무엇을 하려는지” 설명
- 사용자 클릭 또는 승인 후에만 실행 허용
- 실행 이력(log)을 남기고 사용자에게 피드백 제공

> ❌ “접근 요청됨”  
> ✅ “이 도구는 슬랙 채널 목록을 조회하려고 합니다. 허용하시겠습니까?”

---

## 3. 최소 권한 원칙 (Least Privilege)

MCP 서버는 오직 “정해진 기능”만 실행하도록 제한해야 합니다.  
이는 **공격 확장 방지, 공급망 보안 유지**에 매우 중요합니다.

### 실천 전략

- API 호출은 **Read-only부터 시작**하고, 쓰기/삭제는 별도 도구로 분리
- scope를 기능 단위로 쪼개서 요청 (예: `read:calendar`, `write:email`)
- 서버 내부에서도 RBAC 적용: 사용자 권한, IP 기반 제한 등 고려

---

## 4. 세션 보호와 토큰 처리

MCP는 지속적인 세션 연결(예: 컨텍스트 유지, 캐시 활용)을 가질 수 있습니다.  
이 경우 다음과 같은 보안 이슈가 생깁니다:

### 보안 리스크

- 세션 탈취 → 외부 도구 무단 사용 가능
- 오래된 세션을 재사용하는 **Replay 공격**
- 토큰 만료 없이 무기한 연결 유지

### 방어 전략

- 세션 토큰은 **짧은 유효기간(JWT + 만료 시간)** 설정
- 세션마다 고유한 **서명(Signature)** 적용
- 승인 후 일정 시간(예: 10분) 이후 자동 만료
- 요청마다 재검증(Nonce, Timestamp 기반)

---

## 5. MCP 서버 설계자를 위한 보안 체크리스트

| 항목 | 보안 조치 |
|------|-----------|
| 인증 방식 | OAuth 2.1, PKCE, JWT |
| 사용자 동의 | 명시적 동의, 권한 설명 UI |
| 권한 범위 | 기능 단위 scope 세분화 |
| 토큰 보관 | 암호화 저장, 자동 갱신/폐기 |
| 로그 기록 | 도구 호출, 사용자 승인 로그 |
| 외부 요청 처리 | 요청 구조 제한(JSON Schema) |
| 세션 보호 | 만료 시간, Replay 방지, 서명 검증 |

---

## 마무리 요약

MCP는 매우 강력한 연결 도구지만, 그만큼 보안 리스크도 함께 존재합니다.  
특히 MCP 서버 개발자는 아래 3가지 원칙을 항상 기억해야 합니다:

1. **“도구 연결 = 권한 연결”**  
   → 모든 연결은 잠재적 침해 경로가 될 수 있음

2. **“사용자가 이해하고 승인한 동작만 실행”**  
   → 프롬프트로 감추지 말고, UI로 드러내라

3. **“기본값은 제한, 확장은 예외적으로”**  
   → 최소 권한 구조를 기본 설계로 채택하라

---

✅ 이 문서는 기술적 보안 구조에 초점을 맞췄습니다.  
향후 운영 보안, 입력 검증, 도구 노출 정책은 별도 문서로 확장할 수 있습니다.
